---
name: backend-doc-writer
description: NestJS 后端模块文档撰写与审查工具。用于创建和审查符合团队规范的后端模块架构文档（docs/api/modules/*.md）。当用户需要：(1) 为后端模块编写架构文档，(2) 审查现有后端文档是否符合规范，(3) 理解如何编写符合"文档即代码"原则的后端文档时使用。
---

# 后端模块文档撰写与审查

## 核心原则：文档即代码（Docs as Code）

后端文档遵循"文档即代码"理念：

- **文档重在指引** - 说明架构思路、设计原则、功能位置，而非复制代码实现
- **保持文档简洁** - 通过代码位置引用让开发者直接查看实现
- **与代码同步** - 文档存放在代码仓库中，与代码一起进行版本管理

## 功能

### 1. 文档撰写

为 NestJS 后端模块生成符合规范的架构文档。

**触发示例：**
```
"帮我为 user 模块编写架构文档"
"根据 src/modules/order/ 生成模块文档"
"我需要为认证模块写文档"
```

**执行流程：**

1. **读取模块代码** - 扫描模块目录结构（Controller、Service、Entity、DTO）

2. **检查代码注释完整性** - 评估是否有足够信息生成文档：
   - ✅ **注释完整**：代码中有 JSDoc/装饰器注释，业务逻辑清晰，且满足：
     - Controller 有 `@ApiTags()` 装饰器
     - 接口方法有 `@ApiOperation()` 和 `@ApiResponse()` 装饰器
     - DTO 字段有 `@ApiProperty()` 装饰器（包含 `description` 和 `example`）
   - ⚠️ **注释不全**：缺少关键注释、业务逻辑模糊，或 Swagger 装饰器不完整
   - ❌ **注释缺失**：几乎没有注释，无法理解业务逻辑

3. **信息确认（如果注释不全）** - 使用问答+选项形式引导用户确认：
   - 模块的核心职责
   - 核心功能及设计思路
   - 使用的设计模式或架构模式
   - 数据库关联关系

   ⚠️ **严格禁止盲目生成**：如果代码注释不足且用户未确认信息，不得直接生成文档

4. **生成文档内容** - 创建 `docs/api/modules/{模块名}.md`，包含：

   **必须包含的内容：**
   - **模块职责** - 用 1-2 句话概括模块功能
   - **架构设计** - 列出关键文件的路径和职责
   - **核心功能** - 说明每个核心功能的实现位置和设计思路
   - **数据库关联** - 说明涉及的表和关系
   - **接口文档引用** - 指向自动生成的 API 文档

   **严格禁止的内容：**
   - ❌ 复制粘贴具体代码实现
   - ❌ 详细的函数调用步骤（代码已说明）
   - ❌ 写死的接口参数和返回值（易过时，应从 Swagger 生成）

3. **文档模板示例：**

```markdown
# 用户模块

## 模块职责
负责用户认证、用户信息管理、权限验证

## 架构设计
- **Controller：** `src/modules/user/user.controller.ts` - 处理 HTTP 请求
- **Service：** `src/modules/user/user.service.ts` - 业务逻辑
- **Entity：** `src/modules/user/entities/user.entity.ts` - 用户实体
- **DTO：** `src/modules/user/dto/` - 数据传输对象

## 核心功能

### 用户登录认证
- **实现位置：** `user.service.ts:validateUser()` (第 45 行)
- **设计说明：** 使用 JWT 策略，密码通过 bcrypt 加密验证
- **鉴权策略：** `src/auth/strategies/jwt.strategy.ts`

### 用户权限管理
- **实现位置：** `user.service.ts:checkPermission()` (第 89 行)
- **设计说明：** 基于 RBAC 模型，角色与权限多对多关系

## 数据库关联
- **主表：** `users` - 用户基本信息
- **关联表：** `user_roles`、`roles`、`permissions`

## 接口文档
详细接口参数和返回值见自动生成的 API 文档：`docs/api/README.md`
```

### 2. 文档审查

审查现有后端文档是否符合团队规范。

**触发示例：**
```
"审查 user.md 文档是否符合规范"
"检查我写的订单模块文档"
"这个文档有什么问题？"
```

**审查清单：**

✅ **应该有的内容：**
- [ ] 模块职责（1-2 句话概括）
- [ ] 架构设计（列出关键文件路径和职责）
- [ ] 核心功能（说明实现位置和设计思路）
- [ ] 数据库关联（涉及的表和关系）
- [ ] 接口文档引用（指向 Swagger 文档）

❌ **不应该有的内容：**
- [ ] 复制粘贴的代码实现
- [ ] 详细的函数调用步骤
- [ ] 写死的接口参数和返回值

⚠️ **文档质量标准：**
- [ ] 重在说明"为什么"（设计原因）和"在哪里"（代码位置）
- [ ] 不说明"怎么做"（具体实现留给代码）
- [ ] 通过代码位置引用（如 `user.service.ts:45`）指引开发者
- [ ] 保持简洁，避免冗长描述

📝 **代码注释质量检查（可选）：**
- [ ] Controller 是否添加了 `@ApiTags()` 装饰器
- [ ] 所有接口是否添加了 `@ApiOperation()` 和 `@ApiResponse()` 装饰器
- [ ] DTO 字段是否添加了 `@ApiProperty()` 装饰器（包含 `description` 和 `example`）
- [ ] 本地访问 `/api-docs` 能正常显示文档

**审查输出格式：**

```markdown
## 审查结果

### ✅ 符合规范的部分
- 模块职责描述清晰
- 架构设计列出了关键文件路径

### ❌ 需要改进的部分
- [问题1] 包含了复制粘贴的代码实现（第 XX 行）
  - 建议：删除代码，改为引用代码位置
- [问题2] 写死了接口参数（第 YY 行）
  - 建议：删除参数细节，引用 Swagger 文档

### 📝 改进建议
[具体的修改建议]
```

## 使用场景

**场景 1：新模块开发完成**
```
开发者："我刚完成 payment 模块开发，帮我生成架构文档"
→ 读取 src/modules/payment/ 代码
→ 生成 docs/api/modules/payment.md
```

**场景 2：文档审查**
```
开发者："审查 docs/api/modules/order.md"
→ 读取文档内容
→ 对照审查清单
→ 输出审查结果和改进建议
```

**场景 3：文档修改**
```
开发者："根据审查结果修改 user.md"
→ 根据审查建议修正文档
→ 确保符合"文档即代码"原则
```

## 重要提示

1. **文档位置固定** - 所有后端模块文档存放在 `docs/api/modules/{模块名}.md`
2. **与代码同步** - 模块架构调整时必须同步更新文档
3. **代码位置引用格式** - 使用 `文件名:方法名()` 或 `文件名:行号` 格式
4. **避免重复** - 不要在文档中重复 Swagger 已包含的内容
5. **相关 Skills 协作**
   - 文档完成后，可使用 `feishu-notification-generator` 生成接口开发完成通知
   - 提交前必须使用 `nestjs-code-review` 进行代码审查
