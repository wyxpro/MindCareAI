---
name: react-code-review
description: 专业的 React 和 Next.js 代码审查与架构设计技能,基于 2024-2025 年最佳实践。包含完整的最佳实践知识库,用于对 React 或 Next.js 代码进行代码审查、代码评审、代码检查,以及进行架构设计、代码架构规划、系统设计。涵盖组件设计、TypeScript 类型安全、Hooks 使用、性能优化、安全性、状态管理、可访问性等方面的全面审查和设计指导。适用于函数组件、自定义 Hooks、Next.js App Router/Pages Router、服务器组件和客户端组件的审查和架构设计。
---

# React 代码审查技能

## 概述

此技能为 React 和 Next.js 代码提供全面、专业的代码审查,基于 2024-2025 年的行业最佳实践。审查涵盖代码质量、性能、安全性、可访问性和可维护性等多个维度。

## 何时使用此技能

- 用户明确要求对 React 或 Next.js 代码进行审查、代码评审或代码检查
- 用户要求检查代码质量、性能优化或安全性问题
- 用户询问代码是否符合最佳实践
- 用户请求组件设计或重构建议
- 用户需要进行 React 或 Next.js 项目架构设计或规划
- 用户询问如何设计组件结构、状态管理架构或路由架构
- 用户需要基于最佳实践的前端架构设计建议和指导

## 架构设计时的 .gitignore 配置

当进行项目架构设计时，应为用户生成符合 React/Next.js 技术栈的 .gitignore 文件：

```gitignore
node_modules/
.next/
out/
build/
dist/
.env
.env.*
*.log
coverage/
.idea/
.vscode/
*.swp
.DS_Store
```

## 代码审查工作流程

### 1. 确定审查范围

首先识别要审查的代码类型:
- **纯 React 代码**: 函数组件、Hooks、类组件、Context 等
- **Next.js 代码**: 页面、布局、API 路由、Server Actions、中间件等
- **混合代码**: 同时包含 React 和 Next.js 特性

### 2. 执行多维度审查

按以下顺序进行审查:

1. **组件结构与设计** - 检查组件职责、组合模式、命名约定
2. **TypeScript 类型安全** - 验证类型定义、接口使用、类型推断
3. **Hooks 使用规范** - 审查 useState、useEffect、useMemo、useCallback、自定义 Hooks
4. **性能优化** - 识别性能瓶颈、不必要的重渲染、缺失的优化
5. **安全性** - 检查 XSS 漏洞、输入验证、安全配置
6. **状态管理** - 评估状态组织、Context 使用、状态管理库集成
7. **错误处理** - 检查错误边界、异步错误处理、用户反馈
8. **代码质量** - 评估可读性、可维护性、测试覆盖率
9. **可访问性(a11y)** - 验证语义化 HTML、ARIA 标签、键盘导航
10. **Tailwind CSS 配置** - 检查 Tailwind 配置正确性、使用规范
11. **Next.js 特定** - 如适用,审查路由、数据获取、渲染策略、元数据
12. **代码编译和 Lint 检查** - 运行编译和 lint 工具验证代码质量

### 3. 参考最佳实践文档

根据代码类型,参考相应的最佳实践文档:

- **React 代码**: 查看 `references/react-code-review/react-best-practices.md` 获取详细的 React 最佳实践
- **Next.js 代码**: 查看 `references/react-code-review/nextjs-best-practices.md` 获取 Next.js 特定指导

这些文档包含:
- 详细的代码示例
- 常见问题和陷阱
- 推荐做法和应避免的做法
- 性能优化技巧
- 安全最佳实践

### 4. 生成审查报告

提供结构化的审查报告,包含:

#### 报告结构

```
## 代码审查报告

### 📋 审查概览
- 审查范围: [描述审查的代码]
- 主要技术栈: [React 版本、Next.js 版本、TypeScript 等]
- 总体评分: [优秀/良好/需改进/严重问题]

### ✅ 做得好的地方
[列出代码中值得肯定的实践,鼓励继续保持]

### 🔴 严重问题(必须修复)
[列出可能导致 bug、性能问题或安全漏洞的严重问题]
每个问题包括:
- 问题描述
- 代码位置(文件名:行号)
- 当前代码示例
- 为什么这是问题
- 推荐的修复方案(包含代码示例)
- 相关最佳实践引用

### 🟡 改进建议(建议修复)
[列出可以提升代码质量但不紧急的问题]
每个建议包括:
- 改进点描述
- 代码位置
- 改进前后对比
- 预期收益

### 💡 优化机会
[列出性能优化、代码简化等可选改进]

### 📚 学习资源
[相关的最佳实践文档章节、外部资源链接]
```

## 审查检查清单

### React 组件审查

**组件设计**
- [ ] 组件是否遵循单一职责原则?
- [ ] 组件大小是否合理(< 200-300 行)?
- [ ] 是否使用组合而非继承?
- [ ] Props 钻取是否过深(> 2-3 层)?
- [ ] 命名是否清晰、一致(PascalCase)?

**TypeScript 类型**
- [ ] Props 是否有明确的类型定义?
- [ ] 是否避免使用 `any` 类型?
- [ ] 事件处理器是否有正确的类型?
- [ ] 是否适当使用了泛型?
- [ ] 可选 props 是否正确标记?

**Hooks 使用**
- [ ] Hooks 是否在顶层调用(不在条件/循环中)?
- [ ] useEffect 依赖数组是否完整?
- [ ] 是否有适当的清理函数?
- [ ] useMemo/useCallback 使用是否合理(不过度也不缺失)?
- [ ] 自定义 Hooks 命名是否以 `use` 开头?
- [ ] 状态更新是否使用函数式更新(当依赖前值时)?

**性能**
- [ ] 是否有不必要的重渲染?
- [ ] 列表是否使用稳定的 key(不是索引)?
- [ ] 大型列表是否考虑虚拟化?
- [ ] 是否适当使用 React.memo?
- [ ] 是否有昂贵的计算未被记忆化?
- [ ] 是否使用了代码分割和懒加载?

**安全性**
- [ ] 是否避免使用 dangerouslySetInnerHTML?
- [ ] 如果使用了,HTML 是否经过清理(DOMPurify)?
- [ ] 用户输入是否得到验证?
- [ ] URL 是否经过验证?
- [ ] 是否有潜在的 XSS 漏洞?

**状态管理**
- [ ] 状态是否放在适当的层级?
- [ ] Context 使用是否合理?
- [ ] Context 值是否被记忆化?
- [ ] 是否需要状态管理库?

**错误处理**
- [ ] 是否有错误边界?
- [ ] 异步操作是否有错误处理?
- [ ] 是否向用户显示错误信息?
- [ ] 加载状态是否得到处理?

**代码质量**
- [ ] 代码是否易读易懂?
- [ ] 是否有适当的注释(复杂逻辑)?
- [ ] 是否有重复代码可以提取?
- [ ] 条件渲染是否清晰?
- [ ] 是否有单元测试?

**可访问性**
- [ ] 是否使用语义化 HTML?
- [ ] 交互元素是否可键盘访问?
- [ ] 是否有适当的 ARIA 标签?
- [ ] 表单是否有正确的标签?
- [ ] 图片是否有 alt 文本?

### Next.js 特定审查

**项目结构**
- [ ] 是否使用 App Router(Next.js 13+)?
- [ ] 文件组织是否清晰(page.tsx, layout.tsx, etc.)?
- [ ] 路由组使用是否合理?

**服务器/客户端组件**
- [ ] 是否适当区分服务器组件和客户端组件?
- [ ] 客户端组件是否标记了 'use client'?
- [ ] 是否最小化客户端组件的使用?
- [ ] 服务器组件中是否避免了 Hooks?

**数据获取**
- [ ] 是否在服务器端获取数据?
- [ ] 缓存策略是否合适?
- [ ] 是否使用了适当的重新验证?
- [ ] 是否避免了客户端数据获取瀑布流?

**渲染策略**
- [ ] 是否选择了正确的渲染策略(SSG/SSR/ISR)?
- [ ] 是否使用了流式渲染和 Suspense?
- [ ] loading.tsx 和 error.tsx 是否适当放置?

**性能**
- [ ] 是否使用 next/image 优化图片?
- [ ] 是否使用 next/font 优化字体?
- [ ] 是否使用 next/script 优化脚本?
- [ ] 是否使用动态导入减少包大小?
- [ ] 首屏图片是否设置了 priority?

**Metadata 和 SEO**
- [ ] 是否有适当的 metadata 配置?
- [ ] 动态页面是否使用 generateMetadata?
- [ ] 是否有 Open Graph 标签?

**API 和 Server Actions**
- [ ] API 路由是否遵循 RESTful 原则?
- [ ] Server Actions 是否标记了 'use server'?
- [ ] 是否有适当的错误处理?
- [ ] 是否有输入验证?

**安全性**
- [ ] 环境变量是否正确配置(NEXT_PUBLIC_ 前缀)?
- [ ] 敏感信息是否暴露给客户端?
- [ ] 是否配置了 CSP 头?
- [ ] 中间件是否正确实现认证?

**配置**
- [ ] next.config.js 配置是否合理?
- [ ] TypeScript 配置是否严格?
- [ ] 是否有 ESLint 配置?

### .gitignore 配置检查

- [ ] 是否存在 .gitignore 文件
- [ ] 是否包含 `node_modules/`
- [ ] 是否包含 `.next/`（Next.js 项目）
- [ ] 是否包含 `build/` 或 `dist/`
- [ ] 是否包含 `.env` 及其变体
- [ ] 是否包含 IDE 配置（`.idea/`, `.vscode/`）
- [ ] 是否包含 `coverage/`

**如果修改了 .gitignore**，需清理 git 缓存：
```bash
git rm -r --cached .
git add .
git commit -m "chore: update .gitignore"
```

### Tailwind CSS 配置审查

**Tailwind 配置文件**
- [ ] tailwind.config.js/ts 是否存在并正确配置?
- [ ] content 路径是否包含所有组件文件?
- [ ] 自定义主题配置是否合理(extend vs override)?
- [ ] plugins 使用是否正确?
- [ ] 是否配置了正确的 darkMode 策略?

**Tailwind 使用规范**
- [ ] 是否避免使用内联样式而改用 Tailwind 类?
- [ ] 是否合理使用 @apply 指令(不过度)?
- [ ] 复杂的重复样式是否提取为组件?
- [ ] 是否使用 Tailwind 的响应式前缀(@sm:, @md:, @lg:)?
- [ ] 是否使用 Tailwind 的状态变体(hover:, focus:, active:)?
- [ ] 类名顺序是否一致(建议使用 prettier-plugin-tailwindcss)?

**CSS 文件结构**
- [ ] globals.css 是否只包含 Tailwind 指令和全局样式?
- [ ] 是否正确导入 @tailwind base/components/utilities?
- [ ] 自定义 CSS 是否放在正确的层级(@layer)?

### 代码编译和 Lint 检查

**编译检查**
- [ ] 运行 `npm run build` 或 `yarn build` 检查编译是否通过
- [ ] 是否有 TypeScript 类型错误?
- [ ] 是否有未使用的导入或变量?
- [ ] 构建输出是否有警告信息?

**Lint 检查**
- [ ] 运行 `npm run lint` 或 `yarn lint` 检查代码规范
- [ ] 是否有 ESLint 错误?
- [ ] 是否有 ESLint 警告需要修复?
- [ ] 代码格式是否符合 Prettier 配置?

**检查流程**
1. 在审查代码之前,先运行编译和 lint 命令
2. 将编译和 lint 的输出作为审查的一部分
3. 在报告中包含所有编译错误和 lint 问题
4. 为每个错误提供修复建议

## 审查示例

### 示例 1: React 组件审查

**用户请求**: "请审查这个 UserProfile 组件"

**审查流程**:
1. 先运行编译和 lint 命令检查基础代码质量
2. 读取并理解组件代码
3. 检查组件结构、命名、职责
4. 审查 TypeScript 类型定义
5. 检查 Hooks 使用(依赖数组、清理函数等)
6. 识别性能问题(不必要的重渲染等)
7. 检查安全性(XSS、输入验证)
8. 检查 Tailwind CSS 使用规范(如使用了 Tailwind)
9. 评估可访问性
10. 参考 `references/react-code-review/react-best-practices.md` 中的相关章节
11. 生成结构化的审查报告,包含编译和 lint 结果

### 示例 2: Next.js 页面审查

**用户请求**: "审查这个 Next.js 博客页面的代码"

**审查流程**:
1. 运行 `npm run build` 检查构建是否成功
2. 运行 `npm run lint` 检查代码规范
3. 识别是 App Router 还是 Pages Router
4. 检查服务器组件和客户端组件的使用
5. 审查数据获取策略(fetch、缓存、重新验证)
6. 检查 metadata 配置
7. 检查 Tailwind 配置和使用
8. 评估性能优化(Image、Font、Script 组件)
9. 审查 TypeScript 类型和 Props
10. 检查错误处理和加载状态
11. 参考 `references/react-code-review/nextjs-best-practices.md` 中的相关章节
12. 生成包含 Next.js 特定建议的审查报告,包括构建和 lint 结果

## 审查原则

### 建设性反馈
- 始终解释"为什么"某个做法是问题
- 提供具体的、可操作的改进建议
- 包含代码示例展示正确做法
- 引用权威资源和最佳实践文档

### 优先级划分
- **严重问题**: 可能导致 bug、安全漏洞或严重性能问题
- **改进建议**: 提升代码质量,但不会导致严重后果
- **优化机会**: 锦上添花的改进,可选实施

### 平衡性
- 指出问题的同时,也认可做得好的地方
- 考虑项目的具体场景和约束
- 避免过度优化和过早优化
- 尊重团队的编码风格(在不违反最佳实践的前提下)

### 教育性
- 帮助开发者理解最佳实践背后的原理
- 提供学习资源和进一步阅读材料
- 分享现代 React/Next.js 的新特性和模式

## 参考资源

### 最佳实践文档
- `references/react-code-review/react-best-practices.md` - React 全面最佳实践指南
- `references/react-code-review/nextjs-best-practices.md` - Next.js 特定最佳实践

这些文档包含详细的代码示例、常见问题和深入的技术指导。在审查过程中应主动参考这些文档,并在报告中引用相关章节。

### 何时读取参考文档

**自动读取场景**:
- 审查涉及性能优化时,读取相应的性能章节
- 审查涉及安全性时,读取安全最佳实践章节
- 审查 Hooks 使用时,读取 Hooks 最佳实践章节
- 审查 Next.js 特定功能时,读取 Next.js 文档的相关部分

**按需读取**:
- 遇到不确定的模式或实践时
- 需要详细的代码示例支持建议时
- 需要引用权威最佳实践时
